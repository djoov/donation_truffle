{% extends "base.html" %}

{% block content %}

<div class="section-header">
    <h2>Admin Dashboard</h2>
    <p>Panel kontrol untuk validasi dan moderasi kampanye.</p>
</div>

<!-- Konfigurasi Admin (Agar tidak input berulang kali) -->
<div class="card" style="background: #fff3e0; border: 1px solid #ffe0b2;">
    <h3 style="font-size: 1.1rem; margin-bottom: 15px;"><i class="fa-solid fa-key"></i> Konfigurasi Akun Admin</h3>
    <p style="font-size: 0.9rem; margin-bottom: 15px;">Masukkan kredensial Admin di sini untuk melakukan aksi (Approve/Reject).</p>
    <div style="display: flex; gap: 10px;">
        <input type="text" id="admin_addr" class="input-field" style="margin:0;" placeholder="Admin Address">
        <input type="password" id="admin_pk" class="input-field" style="margin:0;" placeholder="Admin Private Key">
    </div>
</div>

<div class="card" style="padding: 0; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f9fafb; text-align: left;">
                <th style="padding: 15px 20px; border-bottom: 1px solid #eee;">ID</th>
                <th style="padding: 15px 20px; border-bottom: 1px solid #eee;">Judul</th>
                <th style="padding: 15px 20px; border-bottom: 1px solid #eee;">Creator</th>
                <th style="padding: 15px 20px; border-bottom: 1px solid #eee;">Status</th>
                <th style="padding: 15px 20px; border-bottom: 1px solid #eee;">Aksi</th>
            </tr>
        </thead>
        <tbody>
            {% for c in campaigns %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 15px 20px;">#{{ c.id }}</td>
                <td style="padding: 15px 20px; font-weight: 600;">{{ c.title }}</td>
                <td style="padding: 15px 20px; font-family: monospace; color: #666;">{{ c.creator[:10] }}...</td>
                <td style="padding: 15px 20px;">
                    {% if c.status_label == 'Pending' %}
                        <span style="background:#fff3cd; color:#856404; padding:4px 8px; border-radius:4px; font-size:0.8rem;">Pending</span>
                    {% elif c.status_label == 'Active' %}
                        <span style="background:#d4edda; color:#155724; padding:4px 8px; border-radius:4px; font-size:0.8rem;">Active</span>
                    {% elif c.status_label == 'Rejected' %}
                        <span style="background:#f8d7da; color:#721c24; padding:4px 8px; border-radius:4px; font-size:0.8rem;">Rejected</span>
                    {% else %}
                        <span style="background:#e2e3e5; color:#383d41; padding:4px 8px; border-radius:4px; font-size:0.8rem;">{{ c.status_label }}</span>
                    {% endif %}
                </td>
                <td style="padding: 15px 20px;">
                    <div style="display: flex; gap: 5px;">
                        <!-- Tombol Approve -->
                        <form action="/ui/admin/action/approve/{{ c.id }}" method="POST" onsubmit="return fillCreds(this)">
                            <input type="hidden" name="from" class="hidden-from">
                            <input type="hidden" name="private_key" class="hidden-pk">
                            <button type="submit" class="button button-sm" style="background: #2E7D32; font-size: 0.7rem;" {% if c.status_code != 0 %}disabled{% endif %}>
                                <i class="fa-solid fa-check"></i>
                            </button>
                        </form>

                        <!-- Tombol Reject -->
                        <form action="/ui/admin/action/reject/{{ c.id }}" method="POST" onsubmit="return fillCreds(this)">
                            <input type="hidden" name="from" class="hidden-from">
                            <input type="hidden" name="private_key" class="hidden-pk">
                            <button type="submit" class="button button-sm" style="background: #C62828; font-size: 0.7rem;" {% if c.status_code != 0 %}disabled{% endif %}>
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    // Fungsi JS Sederhana untuk menyalin kredensial admin ke form sebelum submit
    function fillCreds(form) {
        const addr = document.getElementById('admin_addr').value;
        const pk = document.getElementById('admin_pk').value;

        if(!addr || !pk) {
            alert("Mohon isi Address dan Private Key Admin di bagian atas!");
            return false;
        }

        form.querySelector('.hidden-from').value = addr;
        form.querySelector('.hidden-pk').value = pk;
        return true;
    }
</script>

{% endblock %}